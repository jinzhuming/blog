
---
title: Vue 的 computed 是如何收集依赖的
---

# Vue 的 computed 是如何收集依赖的
### 背景
之前在面试主要是用 Vue 的候选人的时候，我都会问到这么一个问题：
**Vue 的 computed 是如何收集依赖的**
比如这段代码：
``` javascript
export default {
    data() {
        return {
            name:'小明',
            age: 13
        }
    },
    computed: {
        msg() {
            return `${this.name}的年龄是${this.age}`
        }
    }
}
```
`msg` 这个函数是如何知道他内部使用了 `this.name` 以及 `this.age` 的呢？有些人会说，因为他明确写了 `this.name`，所以函数知道啊，可是你仔细想一下，如果不从 `babel` 这种编译阶段入手，你是怎么写代码能获取一个函数内部访问的数据？所以他显然不是这么简单，这个问题很多人都答不上来，甚至很多人都有这个疑惑，这次就简单讲一下这个话题记录一下。

事实上我已经很多年没用 `vue` 了，问这个问题也只是感觉好玩，因为 `computed` 和 `watch` 看起来都是很神奇的东西，但是竟然有这么多人都不知道他怎么实现的，这倒是出乎意料。

### 结论
`vue` 会有一个依赖收集的过程，因为 `data` 内的属性都是被劫持过的属性，所以访问他的时候是能触发 `getter` 的，那么我们只需要执行一遍函数，函数执行的时候自然会触发内部使用过的 `data` 内的属性，再收集一下哪些 `getter` 被触发不就可以知道这个函数内部使用了哪些属性？事实上基本原理就是这样，不止是`computed`，`watch` 也是一样，毕竟 `computed` 就是一个 `lazy` 的 `watch`。这就是最简单的原理，如果你已经理解了这个原理，想了解更详细的细节，直接翻阅源码即可。
